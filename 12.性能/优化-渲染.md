# 渲染优化

## 关键渲染路径优化

浏览器从获取 HTML 到最终在屏幕上显示内容需要完成以下步骤：

1. 处理 HTML 标记并构建 DOM 树。
2. 处理 CSS 标记并构建 CSSOM 树。
3. 将 DOM 与 CSSOM 合并成一个 render tree。
4. 根据渲染树来布局，以计算每个节点的几何信息。
5. 将各个节点绘制到屏幕上。

### 优化策略

1. 优化 DOM：缩小文件的尺寸（Minify）、使用 gzip 压缩（Compress）、使用缓存（HTTP Cache）。
2. 优化 CSS：
   - 非必需的 CSS 都标记为非关键资源（例如打印和其他媒体查询），并应确保尽可能减少关键 CSS 的数量，以及尽可能缩短传送时间。
   - 避免使用@import
   - 使用 CSS3 动画（CSS3 Animation）。
3. 优化 JavaScript：
   - 将脚本放在底部（Body 的底部）。
   - 将脚本标记为异步（async）或延迟（defer）:
     - async 异步脚本：异步脚本不阻塞其他脚本执行，不保证执行顺序。
     - defer 延迟脚本：延迟脚本在 DOMContentLoaded 事件之前执行，保证执行顺序。
   - 避免运行时间过长的 JavaScript

### 资源预加载优化

1. preload（预加载）

   - 用于提前加载当前页面必需的关键资源
   - 适用场景：
     - 字体文件
     - 关键路径上的 CSS 文件
     - 首屏关键图片
     - 重要的 JavaScript 文件
   - 示例：`<link rel="preload" href="style.css" as="style">`

2. prefetch（预获取）
   - 用于提前加载用户将来可能需要的资源
   - 适用场景：
     - 下一页可能用到的资源
     - 未来可能进行的操作需要的资源
     - 其他非首屏资源
   - 示例：`<link rel="prefetch" href="next-page.js">`

注意：preload 是高优先级加载，prefetch 是低优先级加载。不要对同一资源同时使用 preload 和 prefetch。

## JavaScript 执行优化

1. 使用 requestAnimationFrame 实现动画效果
2. 使用 Web Workers 执行密集型计算
3. 事件的节流和防抖
4. 
